{% extends "base_subpage.html" %}

{% block title %}Ludno≈õƒá i Demografia | eStatysta P≈Çock{% endblock %}

{% set page_id = 'ludnosc' %}

{% block content_block %}
    <!-- Wewnƒôtrzny styl dla systemu zak≈Çadek (dodatkowy CSS) -->
    <style>
        .tabs-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding: 0 15px;
            background-color: #f7f7f7;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .tab-button {
            background-color: transparent;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            transition: all 0.3s ease;
            position: relative;
            top: 2px;
        }
        .tab-button.active {
            color: #1a73e8;
            border-bottom: 4px solid #1a73e8;
            background-color: #fff;
            border-radius: 4px 4px 0 0;
            padding-bottom: 8px; /* Kompensacja grubo≈õci linii */
        }
        .tab-button:hover:not(.active) {
            color: #1a73e8;
        }
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        .tab-content.active {
            display: block;
        }
        .news-box {
            background-color: #e9f0fe;
            border-left: 5px solid #1a73e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .control-panel {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    </style>
    
    <h2 class="page-header-title">üë§ Ludno≈õƒá i Demografia</h2>
    
    <!-- SEKACJA AKTUALNO≈öCI -->
    <div class="news-box" role="alert">
        <strong>üîî Najnowszy Raport (Czerwiec 2024):</strong> W I kwartale 2024 saldo migracji w P≈Çocku pozostaje ujemne (-150 os√≥b), przy stabilnym wsp√≥≈Çczynniku urodze≈Ñ (9.2‚Ä∞). Szczeg√≥≈Çy w zak≈Çadce "Ruch Naturalny".
    </div>
    
    <!-- SEKACJA FILTR√ìW I NARZƒòDZI -->
    <div class="control-panel">
        <label for="year-select" style="font-weight: 600;">Wybierz Rok Danych:</label>
        <select id="year-select" onchange="loadDataByYear(this.value)" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="2024">2024 (Prognoza)</option>
            <option value="2023" selected>2023 (Ostateczne)</option>
            <option value="2022">2022</option>
        </select>
        
        <button style="margin-left: 20px; padding: 5px 15px; background-color: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer;">
            <i class="fas fa-chart-bar"></i> Por√≥wnaj z Mazowszem
        </button>
    </div>

    <!-- SYSTEM ZAK≈ÅADEK (PODKATEGORIE) -->
    <div class="tabs-container">
        <button class="tab-button active" onclick="switchTab('sumaryczny', this)">Podsumowanie</button>
        <button class="tab-button" onclick="switchTab('struktura', this)">Struktura Wieku</button>
        <button class="tab-button" onclick="switchTab('ruch', this)">Ruch Naturalny</button>
        <button class="tab-button" onclick="switchTab('migracje', this)">Migracje</button>
    </div>

    <!-- TRE≈öƒÜ ZAK≈ÅADEK -->
    <div class="main-content-area">
        
        <!-- ZAK≈ÅADKA 1: PODSUMOWANIE (Aktywna domy≈õlnie) -->
        <div id="sumaryczny" class="tab-content active">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Liczba Mieszka≈Ñc√≥w P≈Çocka (Og√≥≈Çem)</h3>
                    <p class="main-metric">117 099</p>
                    <p class="change-info">‚Üì -0.8% r/r (Trend kontynuacji spadku)</p>
                </div>

                <div class="data-preview card">
                    <h3>Wska≈∫nik ObciƒÖ≈ºenia Demograficznego</h3>
                    <p class="main-metric">58.7%</p>
                    <p class="change-info">Wysoki odsetek os√≥b niepracujƒÖcych na 100 os√≥b pracujƒÖcych</p>
                </div>

                <div class="data-preview full-width chart-container">
                    <h3>Trend Liczby Ludno≈õci (2015-2023)</h3>
                    <canvas id="ludnoscTrendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ZAK≈ÅADKA 2: STRUKTURA WIEKU -->
        <div id="struktura" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview chart-container full-width">
                    <h3>Piramida Wieku P≈Çocka (2023)</h3>
                    <canvas id="piramidaWiekuChart"></canvas>
                </div>
                
                <div class="data-preview card">
                    <h3>≈öredni Wiek Mieszka≈Ñca</h3>
                    <p class="main-metric">43.2 lat</p>
                    <p class="change-info">‚Üë Wzrost o 0.5 roku w stosunku do 2022</p>
                </div>
                
                <div class="data-preview card">
                    <h3>Udzia≈Ç Os√≥b Starszych (65+)</h3>
                    <p class="main-metric">21.4%</p>
                    <p class="change-info">Wskazuje na starzejƒÖce siƒô spo≈Çecze≈Ñstwo</p>
                </div>
            </div>
        </div>

        <!-- ZAK≈ÅADKA 3: RUCH NATURALNY -->
        <div id="ruch" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Liczba Urodze≈Ñ ≈ªywych (rocznie)</h3>
                    <p class="main-metric">950</p>
                    <p class="change-info">Saldo naturalne ujemne: -250</p>
                </div>

                <div class="data-preview card">
                    <h3>Liczba Zgon√≥w (rocznie)</h3>
                    <p class="main-metric">1 200</p>
                    <p class="change-info">Wsp√≥≈Çczynnik zgon√≥w: 10.2‚Ä∞</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wsp√≥≈Çczynnik Urodze≈Ñ vs Zgon√≥w (Wykres Liniowy)</h3>
                    <canvas id="naturalMovementChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ZAK≈ÅADKA 4: MIGRACJE -->
        <div id="migracje" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Saldo Migracji (Roczne)</h3>
                    <p class="main-metric">-450</p>
                    <p class="change-info">G≈Ç√≥wnie odp≈Çyw do gmin o≈õciennych</p>
                </div>
                
                <div class="data-preview full-width">
                    <h3>Tabela: Kierunki Migracji (Przyjazdy/Wyjazdy)</h3>
                    <p>Dane szczeg√≥≈Çowe z podzia≈Çem na gminy powiatu p≈Çockiego i g≈Ç√≥wne miasta docelowe.</p>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- LOGIKA JAVASCRIPT DLA PRZE≈ÅƒÑCZANIA ZAK≈ÅADEK -->
    <script>
        function switchTab(tabId, clickedButton) {
            // 1. Ukryj wszystkie tre≈õci zak≈Çadek
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // 2. Dezaktywuj wszystkie przyciski
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // 3. Poka≈º wybranƒÖ tre≈õƒá
            document.getElementById(tabId).classList.add('active');

            // 4. Aktywuj klikniƒôty przycisk
            clickedButton.classList.add('active');
            
            // UWAGA: Tutaj nale≈ºy dodaƒá logikƒô do od≈õwie≈ºania wykres√≥w Chart.js, 
            // je≈õli zostanƒÖ one zrenderowane w niewidocznych zak≈Çadkach.
            // Np.: if (tabId === 'struktura') { renderPiramidaWieku(); }
        }

        // Uruchomienie funkcji, kt√≥ra wczyta dane z filtra po zmianie
        function loadDataByYear(year) {
            console.log("≈Åadowanie danych dla roku:", year);
            // Tutaj nale≈ºy dodaƒá logikƒô AJAX do pobierania nowych danych i aktualizacji metryk/wykres√≥w
        }
        
        // Renderowanie domy≈õlnego wykresu (Trend Ludno≈õci) po za≈Çadowaniu strony
        document.addEventListener('DOMContentLoaded', () => {
            // Logika inicjujƒÖca wykresy w aktywnej zak≈Çadce 'sumaryczny'
            // Przyk≈Çad (zak≈Çada dostƒôpno≈õƒá Chart.js)
            const ctx = document.getElementById('ludnoscTrendChart');
            if (ctx) {
                 new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['2019', '2020', '2021', '2022', '2023'],
                        datasets: [{
                            label: 'Liczba Ludno≈õci',
                            data: [122500, 121500, 120200, 118800, 117099],
                            borderColor: '#1a73e8',
                            tension: 0.3,
                            fill: true,
                            backgroundColor: 'rgba(26, 115, 232, 0.1)'
                        }]
                    },
                    options: { responsive: true }
                });
            }
        });
    </script>
{% endblock %}
