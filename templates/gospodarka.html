{% extends "base_subpage.html" %}

{% block title %}Gospodarka i Finanse | eStatysta P≈Çock{% endblock %}

{% set page_id = 'gospodarka' %}

{% block content_block %}
    <!-- Wewnƒôtrzny styl dla systemu zak≈Çadek (skopiowany z ludnosc.html, aby zapewniƒá dzia≈Çanie) -->
    <style>
        .tabs-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding: 0 15px;
            background-color: #f7f7f7;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .tab-button {
            background-color: transparent;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            transition: all 0.3s ease;
            position: relative;
            top: 2px;
        }
        .tab-button.active {
            color: #1a73e8;
            border-bottom: 4px solid #1a73e8;
            background-color: #fff;
            border-radius: 4px 4px 0 0;
            padding-bottom: 8px; /* Kompensacja grubo≈õci linii */
        }
        .tab-button:hover:not(.active) {
            color: #1a73e8;
        }
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        .tab-content.active {
            display: block;
        }
        .news-box {
            background-color: #e9f0fe;
            border-left: 5px solid #1a73e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .control-panel {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    </style>

    <h2 class="page-header-title">üìà Gospodarka i Finanse</h2>
    
    <!-- SEKACJA AKTUALNO≈öCI -->
    <div class="news-box" role="alert">
        <strong>üîî Najnowsze Dane (Lipiec 2024):</strong> Stopa bezrobocia w P≈Çocku spad≈Ça do 4.2%. Bud≈ºet miasta odnotowuje wy≈ºsze wp≈Çywy z PIT ni≈º zak≈Çadano. Szczeg√≥≈Çy w zak≈Çadce "Rynek Pracy".
    </div>
    
    <!-- SEKACJA FILTR√ìW I NARZƒòDZI -->
    <div class="control-panel">
        <label for="quarter-select" style="font-weight: 600;">Wybierz Kwarta≈Ç Danych:</label>
        <select id="quarter-select" onchange="loadEconomicData(this.value)" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="Q3-2024">Q3 2024 (Prognoza)</option>
            <option value="Q2-2024" selected>Q2 2024 (Ostateczne)</option>
            <option value="Q1-2024">Q1 2024</option>
        </select>
        
        <button style="margin-left: 20px; padding: 5px 15px; background-color: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer;">
            <i class="fas fa-search-dollar"></i> Analiza Sektoralna
        </button>
    </div>

    <!-- SYSTEM ZAK≈ÅADEK (PODKATEGORIE) -->
    <div class="tabs-container">
        <button class="tab-button active" onclick="switchTab('g_podsumowanie', this)">Podsumowanie</button>
        <button class="tab-button" onclick="switchTab('g_praca', this)">Rynek Pracy</button>
        <button class="tab-button" onclick="switchTab('g_budzet', this)">Bud≈ºet Miasta</button>
        <button class="tab-button" onclick="switchTab('g_firmy', this)">Przedsiƒôbiorczo≈õƒá</button>
    </div>

    <!-- TRE≈öƒÜ ZAK≈ÅADEK -->
    <div class="main-content-area">
        
        <!-- ZAK≈ÅADKA 1: PODSUMOWANIE (Aktywna domy≈õlnie) -->
        <div id="g_podsumowanie" class="tab-content active">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>≈örednia P≈Çaca Brutto (Q2 2024)</h3>
                    <p class="main-metric">6 820 PLN</p>
                    <p class="change-info">‚Üë +5.5% r/r (Wzrost wolniejszy ni≈º inflacja)</p>
                </div>

                <div class="data-preview card">
                    <h3>Wska≈∫nik Bezrobocia (Powiat P≈Çocki)</h3>
                    <p class="main-metric">4.2%</p>
                    <p class="change-info">‚Üì -0.3 p.p. w stosunku do poprzedniego kwarta≈Çu</p>
                </div>
                
                <div class="data-preview card">
                    <h3>Wydatki Inwestycyjne Miasta (Q2 2024)</h3>
                    <p class="main-metric">45.8 mln PLN</p>
                    <p class="change-info">Realizacja na poziomie 35% planu rocznego</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres: PKB/WDB na 1 mieszka≈Ñca (2019-2023)</h3>
                    <canvas id="gospodarkaPKBChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ZAK≈ÅADKA 2: RYNEK PRACY -->
        <div id="g_praca" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Oferty Pracy (Liczba rejestrowanych)</h3>
                    <p class="main-metric">1 150</p>
                    <p class="change-info">‚Üë 15% w ciƒÖgu ostatniego miesiƒÖca</p>
                </div>

                <div class="data-preview card">
                    <h3>Udzia≈Ç Kobiet w Rejestrowanym Bezrobociu</h3>
                    <p class="main-metric">51.8%</p>
                    <p class="change-info">Niewielki spadek wzglƒôdem Q1</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres: Stopa Bezrobocia (Por√≥wnanie P≈Çock vs Kraj)</h3>
                    <canvas id="unemploymentChart"></canvas>
                </div>

                <div class="data-preview card full-width">
                    <h3>Najbardziej Poszukiwani Pracownicy</h3>
                    <p>DominujƒÖ in≈ºynierowie procesu, operatorzy maszyn CNC, personel medyczny i kierowcy ciƒô≈ºar√≥wek. Braki kadrowe w sektorze IT i us≈Çugach.</p>
                </div>
            </div>
        </div>

        <!-- ZAK≈ÅADKA 3: BUD≈ªET MIASTA -->
        <div id="g_budzet" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Ca≈Çkowite Dochody Miasta (Plan)</h3>
                    <p class="main-metric">1.2 mld PLN</p>
                    <p class="change-info">85% wykonania po Q2</p>
                </div>

                <div class="data-preview card">
                    <h3>Zad≈Çu≈ºenie Miasta</h3>
                    <p class="main-metric">150 mln PLN</p>
                    <p class="change-info">Wska≈∫nik zad≈Çu≈ºenia: 12.5% dochod√≥w</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres Ko≈Çowy: Struktura Wydatk√≥w Miasta (G≈Ç√≥wne Kategorie)</h3>
                    <canvas id="budgetStructureChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- ZAK≈ÅADKA 4: PRZEDSIƒòBIORCZO≈öƒÜ -->
        <div id="g_firmy" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Nowe Rejestracje Firm (Q2 2024)</h3>
                    <p class="main-metric">215</p>
                    <p class="change-info">‚Üë Wzrost liczby start-up√≥w o 8%</p>
                </div>

                <div class="data-preview card">
                    <h3>Liczba Aktywnych Podmiot√≥w Gospodarczych</h3>
                    <p class="main-metric">11 800</p>
                    <p class="change-info">W tym 92% to mikroprzedsiƒôbiorstwa</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres S≈Çupkowy: Struktura Inwestycji Zagranicznych (wg Sektora)</h3>
                    <canvas id="foreignInvestmentChart"></canvas>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- LOGIKA JAVASCRIPT DLA PRZE≈ÅƒÑCZANIA ZAK≈ÅADEK I WZOR√ìW CHART.JS -->
    <script>
        // Funkcja do prze≈ÇƒÖczania zak≈Çadek (konieczna do dzia≈Çania)
        function switchTab(tabId, clickedButton) {
            // 1. Ukryj wszystkie tre≈õci zak≈Çadek
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // 2. Dezaktywuj wszystkie przyciski
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // 3. Poka≈º wybranƒÖ tre≈õƒá
            document.getElementById(tabId).classList.add('active');

            // 4. Aktywuj klikniƒôty przycisk
            clickedButton.classList.add('active');
            
            // Logika ponownego rysowania wykres√≥w (w przypadku Chart.js)
            // Zapewnia, ≈ºe wykresy sƒÖ poprawnie renderowane, gdy zak≈Çadka staje siƒô widoczna.
            if (window.charts && window.charts[tabId]) {
                window.charts[tabId].update();
            } else {
                // Inicjalizacja, je≈õli wykres nie zosta≈Ç jeszcze stworzony (lub go nie ma)
                initializeCharts(tabId); 
            }
        }
        
        // Funkcja do symulacji ≈Çadowania danych na podstawie filtra
        function loadEconomicData(quarter) {
            console.log("≈Åadowanie danych ekonomicznych dla:", quarter);
            // Tutaj logika AJAX do pobierania nowych metryk i od≈õwie≈ºania wykres√≥w
        }
        
        // Przechowywanie instancji wykres√≥w, aby m√≥c je p√≥≈∫niej od≈õwie≈ºaƒá
        window.charts = window.charts || {};

        // Funkcja do inicjalizacji wszystkich wykres√≥w na stronie
        function initializeCharts(activeTabId) {
            // Upewnij siƒô, ≈ºe Chart.js jest za≈Çadowany
            if (typeof Chart === 'undefined') return;

            // Inicjalizacja tylko dla aktywnej zak≈Çadki, aby uniknƒÖƒá problem√≥w z renderowaniem
            if (activeTabId === 'g_podsumowanie') {
                const ctx = document.getElementById('gospodarkaPKBChart');
                if (ctx && !window.charts.g_podsumowanie) {
                    window.charts.g_podsumowanie = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['2019', '2020', '2021', '2022', '2023'],
                            datasets: [{
                                label: 'PKB na 1 mieszka≈Ñca (PLN)',
                                data: [55000, 54500, 58000, 62500, 65000],
                                borderColor: '#00cc99',
                                tension: 0.4,
                                fill: false
                            }]
                        },
                        options: { responsive: true }
                    });
                }
            } else if (activeTabId === 'g_praca') {
                 const ctx = document.getElementById('unemploymentChart');
                if (ctx && !window.charts.g_praca) {
                    window.charts.g_praca = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Stycze≈Ñ', 'Luty', 'Marzec', 'Kwiecie≈Ñ', 'Maj', 'Czerwiec'],
                            datasets: [
                                {
                                    label: 'P≈Çock',
                                    data: [5.1, 5.0, 4.8, 4.5, 4.2, 4.2],
                                    backgroundColor: '#1a73e8'
                                },
                                {
                                    label: 'Kraj',
                                    data: [5.4, 5.3, 5.2, 5.1, 5.0, 4.9],
                                    backgroundColor: '#cccccc'
                                }
                            ]
                        },
                        options: { responsive: true, scales: { y: { beginAtZero: false } } }
                    });
                }
            } else if (activeTabId === 'g_budzet') {
                const ctx = document.getElementById('budgetStructureChart');
                if (ctx && !window.charts.g_budzet) {
                    window.charts.g_budzet = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Edukacja', 'Transport', 'Zdrowie', 'Administracja', 'Kultura', 'Inne'],
                            datasets: [{
                                data: [35, 20, 10, 15, 8, 12],
                                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']
                            }]
                        },
                        options: { responsive: true, plugins: { legend: { position: 'right' } } }
                    });
                }
            } else if (activeTabId === 'g_firmy') {
                const ctx = document.getElementById('foreignInvestmentChart');
                if (ctx && !window.charts.g_firmy) {
                     window.charts.g_firmy = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Produkcja Chemiczna', 'Energetyka', 'Us≈Çugi IT', 'Handel', 'Budownictwo'],
                            datasets: [{
                                label: 'Warto≈õƒá Inwestycji (mln PLN)',
                                data: [500, 200, 80, 50, 40],
                                backgroundColor: '#00cc99',
                            }]
                        },
                        options: { responsive: true, indexAxis: 'y' }
                    });
                }
            }
        }
        
        // Inicjalizacja wykres√≥w dla aktywnej domy≈õlnie zak≈Çadki po za≈Çadowaniu DOM
        document.addEventListener('DOMContentLoaded', () => {
             initializeCharts('g_podsumowanie');
        });
    </script>
{% endblock %}
