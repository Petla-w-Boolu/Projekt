{% extends "base_subpage.html" %}

{% block title %}≈örodowisko | eStatysta P≈Çock{% endblock %}

{% set page_id = 'srodowisko' %}

{% block content_block %}
    <!-- Wewnƒôtrzny styl dla systemu zak≈Çadek (konieczny do poprawnego wy≈õwietlania) -->
    <style>
        .tabs-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding: 0 15px;
            background-color: #f7f7f7;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .tab-button {
            background-color: transparent;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            transition: all 0.3s ease;
            position: relative;
            top: 2px;
        }
        .tab-button.active {
            color: #1a73e8;
            border-bottom: 4px solid #1a73e8;
            background-color: #fff;
            border-radius: 4px 4px 0 0;
            padding-bottom: 8px;
        }
        .tab-button:hover:not(.active) {
            color: #1a73e8;
        }
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        .tab-content.active {
            display: block;
        }
        .news-box {
            background-color: #e9f0fe;
            border-left: 5px solid #1a73e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .control-panel {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    </style>

    <h2 class="page-header-title">üå≥ ≈örodowisko</h2>
    
    <!-- SEKACJA AKTUALNO≈öCI -->
    <div class="news-box alert-success" role="alert">
        <strong>‚úÖ Sukces Ekologiczny (Pa≈∫dziernik 2024):</strong> P≈Çock osiƒÖgnƒÖ≈Ç cel recyklingu na poziomie 48%. Rozpoczƒôcie nasadze≈Ñ w ramach projektu "Zielone P≈Çuca P≈Çocka". Szczeg√≥≈Çy w zak≈Çadce "Woda i Odpady".
    </div>
    
    <!-- SEKACJA FILTR√ìW I NARZƒòDZI -->
    <div class="control-panel">
        <label for="date-select" style="font-weight: 600;">Wybierz Okres Pomiaru:</label>
        <select id="date-select" onchange="loadEnvironmentData(this.value)" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="last-month" selected>Ostatni MiesiƒÖc</option>
            <option value="last-quarter">Ostatni Kwarta≈Ç</option>
            <option value="last-year">Ostatni Rok</option>
        </select>
        
        <button style="margin-left: 20px; padding: 5px 15px; background-color: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer;">
            <i class="fas fa-filter"></i> Analiza ≈πr√≥de≈Ç Zanieczyszcze≈Ñ
        </button>
    </div>

    <!-- SYSTEM ZAK≈ÅADEK (PODKATEGORIE) -->
    <div class="tabs-container">
        <button class="tab-button active" onclick="switchTab('s_podsumowanie', this)">Podsumowanie</button>
        <button class="tab-button" onclick="switchTab('s_powietrze', this)">Jako≈õƒá Powietrza</button>
        <button class="tab-button" onclick="switchTab('s_odpady', this)">Woda i Odpady</button>
        <button class="tab-button" onclick="switchTab('s_ziele≈Ñ', this)">Ziele≈Ñ Miejska</button>
    </div>

    <!-- TRE≈öƒÜ ZAK≈ÅADEK -->
    <div class="main-content-area">
        
        <!-- ZAK≈ÅADKA 1: PODSUMOWANIE (Aktywna domy≈õlnie) -->
        <div id="s_podsumowanie" class="tab-content active">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>≈örednia Jako≈õƒá Powietrza (AQI)</h3>
                    <p class="main-metric">45</p>
                    <p class="change-info">Bardzo dobra jako≈õƒá powietrza (wrzesie≈Ñ)</p>
                </div>

                <div class="data-preview card">
                    <h3>Procent Recyklingu Odpad√≥w</h3>
                    <p class="main-metric">48%</p>
                    <p class="change-info">Cel na 2025: 50%. Wzrost o 2 p.p. r/r</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres Liniowy: Dni z Przekroczeniem Norm PM10 (2019-2023)</h3>
                    <canvas id="smogDaysChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ZAK≈ÅADKA 2: JAKO≈öƒÜ POWIETRZA -->
        <div id="s_powietrze" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Liczba Dni Smogowych (Normy UE)</h3>
                    <p class="main-metric">15 dni</p>
                    <p class="change-info">Spadek o 5 dni w por√≥wnaniu do ubieg≈Çego roku</p>
                </div>

                <div class="data-preview card">
                    <h3>Emisja SO2 (Tlenek Siarki)</h3>
                    <p class="main-metric">Niska</p>
                    <p class="change-info">Dominacja ≈∫r√≥de≈Ç przemys≈Çowych pod kontrolƒÖ</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres Liniowy: Stƒô≈ºenie PM2.5 (Ostatnie 30 dni)</h3>
                    <canvas id="pm25TrendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ZAK≈ÅADKA 3: WODA I ODPADY -->
        <div id="s_odpady" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Zu≈ºycie Wody na Mieszka≈Ñca (m¬≥/rok)</h3>
                    <p class="main-metric">34.5 m¬≥</p>
                    <p class="change-info">Wzrost o 1.2% - konieczna edukacja</p>
                </div>

                <div class="data-preview card">
                    <h3>Produkcja Odpad√≥w Komunalnych (kg/osobƒô)</h3>
                    <p class="main-metric">310 kg</p>
                    <p class="change-info">Stabilny poziom w por√≥wnaniu do 2023</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres Ko≈Çowy: Struktura Odpad√≥w (Recykling/Mieszane/Inne)</h3>
                    <canvas id="wasteStructureChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- ZAK≈ÅADKA 4: ZIELE≈É MIEJSKA -->
        <div id="s_ziele≈Ñ" class="tab-content">
            <div class="data-section-grid">
                
                <div class="data-preview card">
                    <h3>Powierzchnia Park√≥w i Las√≥w (ha)</h3>
                    <p class="main-metric">1 540 ha</p>
                    <p class="change-info">2 ha nowych nasadze≈Ñ w 2024</p>
                </div>

                <div class="data-preview card">
                    <h3>Wska≈∫nik Teren√≥w Zielonych na Mieszka≈Ñca</h3>
                    <p class="main-metric">131 m¬≤ / os.</p>
                    <p class="change-info">Powy≈ºej standard√≥w WHO</p>
                </div>
                
                <div class="data-preview full-width chart-container">
                    <h3>Wykres S≈Çupkowy: Typy Teren√≥w Zielonych (Lasy, Parki, Ziele≈Ñ osiedlowa)</h3>
                    <canvas id="greenAreaChart"></canvas>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- LOGIKA JAVASCRIPT DLA PRZE≈ÅƒÑCZANIA ZAK≈ÅADEK I WZOR√ìW CHART.JS -->
    <script>
        // Funkcja do prze≈ÇƒÖczania zak≈Çadek (konieczna do dzia≈Çania)
        function switchTab(tabId, clickedButton) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            clickedButton.classList.add('active');
            
            // Ponowne renderowanie wykres√≥w po zmianie zak≈Çadki
            if (window.charts && window.charts[tabId]) {
                window.charts[tabId].update();
            } else {
                initializeCharts(tabId); 
            }
        }
        
        // Funkcja do symulacji ≈Çadowania danych na podstawie filtra
        function loadEnvironmentData(period) {
            console.log("≈Åadowanie danych ≈õrodowiskowych dla okresu:", period);
            // Tutaj powinna byƒá logika AJAX do pobierania nowych metryk i od≈õwie≈ºania wykres√≥w
        }
        
        window.charts = window.charts || {};

        // Funkcja inicjalizujƒÖca wykresy Chart.js
        function initializeCharts(activeTabId) {
            // Sprawdzenie, czy Chart.js jest dostƒôpny
            if (typeof Chart === 'undefined') return;

            if (activeTabId === 's_podsumowanie') {
                const ctx = document.getElementById('smogDaysChart');
                if (ctx && !window.charts.s_podsumowanie) {
                    window.charts.s_podsumowanie = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['2019', '2020', '2021', '2022', '2023'],
                            datasets: [{
                                label: 'Dni z przekroczeniem PM10 (rocznie)',
                                data: [45, 38, 30, 25, 20],
                                borderColor: '#FF6384',
                                tension: 0.5,
                                fill: true,
                                backgroundColor: 'rgba(255, 99, 132, 0.1)'
                            }]
                        },
                        options: { responsive: true, scales: { y: { beginAtZero: true } } }
                    });
                }
            } else if (activeTabId === 's_powietrze') {
                 const ctx = document.getElementById('pm25TrendChart');
                if (ctx && !window.charts.s_powietrze) {
                    window.charts.s_powietrze = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['1.X', '5.X', '10.X', '15.X', '20.X', '25.X', '30.X'],
                            datasets: [{
                                label: '≈örednie PM2.5 (¬µg/m¬≥)',
                                data: [15, 18, 12, 10, 22, 14, 11],
                                borderColor: '#4BC0C0',
                                tension: 0.3,
                                fill: false
                            }]
                        },
                        options: { responsive: true, scales: { y: { suggestedMin: 5, suggestedMax: 30 } } }
                    });
                }
            } else if (activeTabId === 's_odpady') {
                const ctx = document.getElementById('wasteStructureChart');
                if (ctx && !window.charts.s_odpady) {
                    window.charts.s_odpady = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Odpady Recyklingowe', 'Odpady Mieszane', 'Odpady Bio', 'Inne'],
                            datasets: [{
                                data: [48, 35, 10, 7],
                                backgroundColor: ['#00cc99', '#cccccc', '#FF9F40', '#36A2EB']
                            }]
                        },
                        options: { responsive: true, plugins: { legend: { position: 'right' } } }
                    });
                }
            } else if (activeTabId === 's_ziele≈Ñ') {
                const ctx = document.getElementById('greenAreaChart');
                if (ctx && !window.charts.s_ziele≈Ñ) {
                     window.charts.s_ziele≈Ñ = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Lasy Miejskie', 'Parki i Skwery', 'Ziele≈Ñ Osiedlowa', 'Ogrody Dzia≈Çkowe'],
                            datasets: [{
                                label: 'Powierzchnia (ha)',
                                data: [800, 300, 240, 200],
                                backgroundColor: '#00cc99',
                            }]
                        },
                        options: { responsive: true, scales: { y: { beginAtZero: true } } }
                    });
                }
            }
        }
        
        // Inicjalizacja wykres√≥w dla aktywnej domy≈õlnie zak≈Çadki po za≈Çadowaniu DOM
        document.addEventListener('DOMContentLoaded', () => {
             initializeCharts('s_podsumowanie');
        });
    </script>
{% endblock %}
